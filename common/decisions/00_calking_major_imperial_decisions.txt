
# Commented out for now until it's finished, so that erroring doesn't keep occurring.
# end_the_imperial_civil_war = {

# 	major = yes

# 	is_shown = {
# 		is_ruler = yes
# 		is_landed = yes
# 		OR = {
# 			has_title = title:e_southern_civil_war_empire
# 			has_title = title:e_western_civil_war_empire
# 			has_title = title:e_northern_civil_war_empire
# 		}
# 		NOT = {  #Can only do it once.
# 		is_target_in_global_variable_list = {
# 			name = unavailable_unique_decisions
# 			target = flag:flag_ended_imperial_civil_war
# 		}
# 		}
# 	}

# 	is_valid = {
# 		#completely_controls_region = region_imperial_calradia
# 		always = yes
# 	}

# 	is_valid_showing_failures_only = {
# 		is_capable_adult = yes
# 		is_imprisoned = no
# 		is_independent_ruler = yes
# 	}


# 	effect = {
# 		custom_tooltip = ended_imperial_civil_war_custom_tooltip

# 		end_imperial_civil_war_scripted_effect = yes
# 		hidden_effect = {
# 			add_to_global_variable_list = {
# 				name = unavailable_unique_decisions
# 				target = flag:flag_ended_imperial_civil_war
# 			}
# 			set_global_variable = {
# 				name = flag:flag_ended_imperial_civil_war
# 				value = root
# 			}
# 		}
# 	}
		
# 	ai_potential = {
# 		always = yes
# 	}

# 	ai_will_do = {
# 		base = 100
# 	}
# }

### CHOOSE YOUR SENATE FACTION ###

choose_imperial_faction_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	
	desc = choose_imperial_faction_desc

	sort_order = 110


	is_shown = {
		is_ruler = yes
		is_landed = yes
		government_has_flag = government_is_feudal
		highest_held_title_tier >= tier_duchy
		# OR = { # CK_IRLFIT - The trigger down below is for a future law we can add to the senate. Non-Calradians can become citizens and members of the senate CK_UPDATE CK_SENATE CK_EMPIRE
				# calradian_law_foreign_citizenship = yes
				culture = { has_cultural_pillar = heritage_calradian }
			# }
		is_ai = no
	}
	
	is_valid = {
		is_ai = no
		OR = {
			custom_description = {
				text = senate_faction_custom_description
				trigger_if = {
					limit = {
						AND = {
						highest_held_title_tier >= tier_duchy
						is_independent_ruler = no
					}
					}
				}
				
			}
			custom_description = {
				text = senate_faction_custom_description_2
				trigger_if = {
					limit = {
						OR = {
							has_primary_title = title:e_calradian_empire
							has_primary_title = title:e_southern_empire
							has_primary_title = title:e_western_empire
							has_primary_title = title:e_northern_empire
						}
					}
				}
				
			}
		}
	}
	is_valid_showing_failures_only = {
		is_capable_adult = yes
 		is_imprisoned = no
		prestige >= 0
	}
	cost = {
		prestige = 100
	}

	cooldown = { years = 10 }

	effect = {
		# Show Possible Factions
		show_as_tooltip = {
			random_list = {
				desc = choose_imperial_faction_list_tt
				100 = {
					show_chance = no
					desc = choose_imperial_faction_list.select_oligarchs
					add_trait_force_tooltip = ck_oligarch
				}
				100 = {
					show_chance = no
					desc = choose_imperial_faction_list.select_militarists
					add_trait_force_tooltip = ck_militarist
				}
				100 = {
					show_chance = no
					desc = choose_imperial_faction_list.select_royalists
					add_trait_force_tooltip = ck_royalist
				}
				100 = {
					show_chance = no
					desc = choose_imperial_faction_list.select_populists
					add_trait_force_tooltip = ck_populist
				}
			}
		}
		trigger_event = calradian_senate_decisions.0010
	}

	ai_will_do = {
		base = 0
	}
	ai_check_interval = 0

}

### The Fate of the Eastern Islands, adjusted from a Godherja decision. ###
ck_the_fate_of_the_east_islands_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_found_kingdom.dds"
	}
	decision_group_type = major
	ai_check_interval = 300
	desc = ck_the_fate_of_the_east_islands_decision_desc

	is_shown = {
		AND = {
			exists = capital_province
			capital_province = { geographical_region = region_mytophion }
		}
		NOR = {
			exists = title:k_mytophion.holder
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_ck_the_fate_of_the_east_islands_decision
			}
		}
	}

	is_valid = {
		OR = {
			is_independent_ruler = yes
			top_liege = {
				highest_held_title_tier = tier_empire
			}
		}
		has_title = title:d_konios
		has_title = title:d_atacarys
	}

	is_valid_showing_failures_only = {
		is_capable_adult = yes
		is_imprisoned = no
		is_at_war = no
	}

	cost = {
		gold = 150
	}

	effect = {
		save_scope_as = mytophion_founder

		#Events
		trigger_event = ck_island_events.0001

		#Can only happen once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:flag_ck_the_fate_of_the_east_islands_decision
		}
		set_global_variable = {
			name = flag_ck_the_fate_of_the_east_islands_decision
			value = root
		}
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 5
		ai_value_modifier = {
			ai_boldness = 1.0
		}
	}
}

### Convert to Admin - Return to the Imperial ways ###

ck_convert_to_administrative_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/ep3_cerimonial_decision.dds"
	}
	decision_group_type = major
	desc = ck_convert_to_administrative_decision_desc

	ai_check_interval = 36

	is_shown = {
		has_ep3_dlc_trigger = yes
		OR = {
			government_has_flag = government_is_feudal
			government_has_flag = government_is_clan
		}
		culture = { has_cultural_pillar = heritage_calradian }
	}

	is_valid = {
		has_ep3_dlc_trigger = yes
		OR = {
			government_has_flag = government_is_feudal
			government_has_flag = government_is_clan
		}
		is_independent_ruler = yes
		prestige_level >= 3
		trigger_if = {
			limit = {
				is_ai = no
			}
			custom_tooltip = {
				text = ck_all_powerful_vassals_required_tt
				any_powerful_vassal = {
					count = all
					opinion = {
						target = root
						value >= 0
					}
				}
			}
		}
		
	}
	
	is_valid_showing_failures_only = {
		is_at_war = no
	}

	cost = {
		prestige = {
			value = 800
			if = {
				limit = {
					is_ai = no
					OR = {
						has_trait = ck_royalist
						has_trait = ck_populist
						has_trait = ck_militarist
					}
				}
				multiply = 4
			}
			if = { # Much cheaper for vassals wanting to adopt their admin liege's government
				limit = {
					is_independent_ruler = no
				}
				multiply = 0.1
			}
		}
		gold = {
			value = 400
			#AI is handicapped
			if = {
				limit = { is_ai = yes }
				multiply = 0.5
			}
			if = {
				limit = { is_ai = no }
				#Realm size
				if = {
					limit = { root.realm_size >= 300 }
					multiply = 3.5
				}
				else_if = {
					limit = { root.realm_size >= 250 }
					multiply = 3
				}
				else_if = {
					limit = { root.realm_size >= 200 }
					multiply = 2.5
				}
				else_if = {
					limit = { root.realm_size >= 150 }
					multiply = 2
				}
				else_if = {
					limit = { root.realm_size >= 100 }
					multiply = 1.5
				}
			}
			#Income
			if = {
				limit = { root.monthly_character_income >= 100 }
				multiply = 3
			}
			else_if = {
				limit = { root.monthly_character_income >= 80 }
				multiply = 2.5
			}
			else_if = {
				limit = { root.monthly_character_income >= 60 }
				multiply = 2
			}
			else_if = {
				limit = { root.monthly_character_income >= 40 }
				multiply = 1.5
			}
			else_if = {
				limit = { root.monthly_character_income >= 20 }
				multiply = 1.1
			}

			max = 3000
			
		}
	}

	effect = {
		save_scope_as = actor
		convert_to_administrative_from_feudalism_effect = yes
		trigger_event = ep3_decisions_event.4060 #Also sends information event to human vassals
		#Letter event for the vassals
		hidden_effect = {
			if = {
				limit = {
					is_ai = no
				}
				add_achievement_global_variable_effect = {
					VARIABLE = achieved_epic_paperwork_achievement
					VALUE = yes
				}
			}
		}
	}

	ai_potential = {
		OR = {
			government_has_flag = government_is_feudal
			government_has_flag = government_is_clan
		}
		is_independent_ruler = yes
	}

	ai_will_do = {
		base = 0
		modifier = {
			highest_held_title_tier = tier_empire
			add = 100
		}
		modifier = {
			has_trait = ck_oligarch
			add = 100
		}
		modifier = {
			culture = {
				has_cultural_tradition = tradition_high_calradic
			}
			add = 75
		}
		modifier = {
			has_trait = content
			add = -20
		}
		modifier = {
			culture = {
				has_cultural_tradition = tradition_vulgar_calradic
			}
			add = -75
		}
		modifier = {
			has_trait = ck_populist
			add = -100
		}
		modifier = {
			highest_held_title_tier = tier_county
			add = -100
		}
		modifier = {
			OR = {
				primary_title = title:e_southern_empire
				primary_title = title:e_western_empire
			}
			add = -200
		}
		modifier = {
			OR = {
				has_trait = ck_militarist 
				has_trait = ck_royalist 
			}
			add = -200
		}
	}
}
