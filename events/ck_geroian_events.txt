namespace = ck_geroian_events

## Coalition War Events
ck_geroian_events.0001 = { ### Coalition info for invader
	type = character_event
	title = ck_geroian_events.0001.t
	desc = ck_geroian_events.0001.desc
	theme = war
	right_portrait = {
		character = root
		animation = worry
	}
	override_background = { reference = study }
	
	immediate = {
		scope:defender = {
			save_scope_as = geroiandefenderloc
		}
	}
	
	option = {
		name = ck_geroian_events.0001.a
		custom_tooltip = ck_geroian_events.0001.a.tt
	}
}
ck_geroian_events.0002 = { ### Coalition info for defender
	type = character_event
	title = ck_geroian_events.0002.t
	desc = ck_geroian_events.0002.desc
	theme = war
	right_portrait = {
		character = root
		animation = personality_bold
	}
	override_background = { reference = wilderness }
	
	immediate = {
		scope:attacker = {
			save_scope_as = geroianattackerloc
		}
	}
	
	
	option = {
		name = ck_geroian_events.0002.a
		custom_tooltip = ck_geroian_events.0002.a.tt
	}
}
ck_geroian_events.0003 = { ### Joined Geroian Coalition
	type = letter_event
	opening = ck_geroian_events.0003.opening
	sender = scope:recipient
	desc = ck_geroian_events.0003.desc
	option = {
		name = ck_geroian_events.0003.a
	}
}
ck_geroian_events.0004 = { ### Declined Geroian Coalition
	type = letter_event
	opening = ck_geroian_events.0004.opening
	sender = scope:recipient
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:recipient = {
						scope:recipient = {
							opinion = {
								target = scope:actor
								value >= -10
							}
						}
					}
				}
				desc = ck_geroian_events.0004.desc.a
			}
			desc = ck_geroian_events.0004.desc.b
		}
	}
	immediate = {
		scope:actor = {
			capital_county = {
				save_scope_as = defendercapitalloc
			}
		}
	}
	
	option = {
		name = ck_geroian_events.0004.a
	}
}
ck_geroian_events.0005 = { ### Geroian support randomizer #REMINDER - DISABLE IT FOR AEKEKARTALS
	type = character_event
	hidden = yes
	
	immediate = {
		random_list = {
			2 = {
				modifier = {
					factor = 0
					any_courtier = {
						has_character_flag = geroian_commoners_leader
					}
				}
				trigger_event = {
					id = ck_geroian_events.0006 # Commoners host join the fight
					days = { 2 7 }
				}
				every_character_war = {
					limit = {
						has_variable = geroian_invasion_var
						NOT = {
							has_variable = geroian_assistance_decided_var
						}
					}
					set_variable = geroian_assistance_yet_to_decide_var
				}
			}
			2 = {
				modifier = {
					factor = 0
					has_character_modifier = extorted_burghers_modifier
				}
				trigger_event = {
					id = ck_geroian_events.0007 # Burghers sponsor a host
					days = { 2 7 }
				}
				every_character_war = {
					limit = {
						has_variable = geroian_invasion_var
						NOT = {
							has_variable = geroian_assistance_decided_var
						}
					}
					set_variable = geroian_assistance_yet_to_decide_var
				}
			}
			2 = {
				modifier = {
					factor = 0
					has_character_modifier = extorted_minor_nobility_modifier
				}
				trigger_event = {
					id = ck_geroian_events.0008 # Landowners sponsor a host
					days = { 2 7 }
				}
				every_character_war = {
					limit = {
						has_variable = geroian_invasion_var
						NOT = {
							has_variable = geroian_assistance_decided_var
						}
					}
					set_variable = geroian_assistance_yet_to_decide_var
				}
			}
			2 = {
				modifier = {
					factor = 0
					any_courtier = {
						has_character_flag = geroian_warrior_monk
					}
				}
				trigger_event = {
					id = ck_geroian_events.0009 # Warrior monk arrives with a host
					days = { 2 7 }
				}
				every_character_war = {
					limit = {
						has_variable = geroian_invasion_var
						NOT = {
							has_variable = geroian_assistance_decided_var
						}
					}
					set_variable = geroian_assistance_yet_to_decide_var
				}
			}
			2 = {
				modifier = {
					factor = 0
					has_character_modifier = extorted_burghers_modifier
				}
				trigger_event = {
					id = ck_geroian_events.0010 # Burghers give monetary assitance
					days = { 2 7 }
				}
				every_character_war = {
					limit = {
						has_variable = geroian_invasion_var
						NOT = {
							has_variable = geroian_assistance_decided_var
						}
					}
					set_variable = geroian_assistance_yet_to_decide_var
				}
			}
			2 = {
				trigger_event = {
					id = ck_geroian_events.0011 # Commoners rally up
					days = { 2 7 }
				}
				every_character_war = {
					limit = {
						has_variable = geroian_invasion_var
						NOT = {
							has_variable = geroian_assistance_decided_var
						}
					}
					set_variable = geroian_assistance_yet_to_decide_var
				}
			}
			2 = { 
				every_character_war = { # Nothing ever happens
					limit = {
						has_variable = geroian_invasion_var
						NOR = {
							has_variable = geroian_assistance_decided_var
							has_variable = geroian_assistance_yet_to_decide_var
						}
					}
					set_variable = geroian_assistance_decided_var
				}
			}
		}
	}
}
ck_geroian_events.0006 = { ### Commoners host join the fight
	type = character_event
	title = ck_geroian_events.0006.t
	desc = ck_geroian_events.0006.desc
	theme = war
	left_portrait = {
		character = scope:geroian_commoner
		animation = marshal_axe
	}
	right_portrait = {
		character = root
		animation = personality_bold
	}
	override_background = { reference = farmland }
	
	immediate = {
		every_character_war = {
			limit = {
				has_variable = geroian_assistance_yet_to_decide_var
			}
			save_scope_as = geroian_war
		}
		create_character = {
			age = { 30 50 }
			gender = male
			trait = brave
			trait = organizer
			trait = peasant_leader
			random_traits_list = {
				education_martial_3 = { }
				education_martial_2 = { }
			}
			faith = root.faith
			culture = root.culture
			location = root.capital_province
			dynasty = none
			prowess = { 12 15 }
			martial = { 8 12 }
			save_scope_as = geroian_commoner
		}
		random_held_title = {
			limit = {
				tier = tier_county
				title_province = {
					geographical_region = region_geroia
				}
			}
			save_scope_as = commoners_county
		}
	}
	option = { # Accept their help
		name = ck_geroian_events.0006.a
		
		custom_tooltip = {
			text = geroian_commoner_host_tt
			spawn_army = {
				war = scope:geroian_war
				men_at_arms = {
					type = geroian_pikemen_1
					men = 400
				}
				men_at_arms = {
					type = geroian_light_infantry
					men = 300
				}
				location = root.capital_province
				inheritable = no
				name = geroian_commoner_host_army
			}
		}
		add_courtier = scope:geroian_commoner
		scope:geroian_commoner = {
			add_character_flag = geroian_commoners_leader
		}
		scope:commoners_county = {
			add_county_modifier = {
				modifier = commoners_fight_modifier
				years = 3
			}
		}
		stress_impact = {
			arrogant = medium_stress_impact_gain
		}
		
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 10
			modifier = {
				add = -10 
				has_trait = arrogant
			}
		}
	}
	option = { #I don't need your help
		name = ck_geroian_events.0006.b
		
		add_prestige = 100
		scope:geroian_commoner = {
			silent_disappearance_effect = yes
		}
		stress_impact = {
			arrogant = medium_stress_loss
		}
		
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 10 
				has_trait = arrogant
			}
		}
	}
}
ck_geroian_events.0007 = { ### Burghers sponsor a host
	type = character_event
	title = ck_geroian_events.0007.t
	desc = ck_geroian_events.0007.desc
	theme = war
	right_portrait = {
		character = root
		animation = personality_bold
	}
	override_background = { reference = market_west }
	
	immediate = {
		every_character_war = {
			limit = {
				has_variable = geroian_assistance_yet_to_decide_var
			}
			save_scope_as = geroian_war
		}
		random_held_title = {
			limit = {
				tier = tier_county
				title_province = {
					geographical_region = region_geroia
				}
			}
			save_scope_as = burghers_county
		}
	}
	option = { # Accept their help
		name = ck_geroian_events.0007.a
		
		custom_tooltip = {
			text = geroian_burgher_host_tt
			spawn_army = {
				war = scope:geroian_war
				men_at_arms = {
					type = geroian_pikemen_2
					men = 200
				}
				men_at_arms = {
					type = geroian_crossbowmen_2
					men = 200
				}
				location = root.capital_province
				inheritable = no
				name = geroian_burgher_host_army
			}
		}
		scope:burghers_county = {
			add_county_modifier = {
				modifier = burghers_tax_cut_modifier
				years = 3
			}
		}
		stress_impact = {
			arrogant = medium_stress_impact_gain
		}
		
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 10
			modifier = {
				add = -10 
				has_trait = arrogant
			}
		}
	}
	option = { # You will help me, whether you like it or not
		name = ck_geroian_events.0007.c
		
		add_tyranny = 10
		custom_tooltip = {
			text = geroian_burgher_host_tt
			spawn_army = {
				war = scope:geroian_war
				men_at_arms = {
					type = geroian_pikemen_2
					men = 200
				}
				men_at_arms = {
					type = geroian_crossbowmen_2
					men = 200
				}
				location = root.capital_province
				inheritable = no
				name = geroian_burgher_host_army
			}
		}
		add_prestige = major_prestige_loss
		add_dread = 15
		add_character_modifier = {
			modifier = extorted_burghers_modifier
			years = 5
		}
		
		stress_impact = {
			wrathful = medium_stress_loss
			greedy = minor_stress_loss
		}
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 20 
				has_trait = wrathful
				NOR = {
					has_trait = just
					has_trait = temperate
					has_trait = compassionate
					has_trait = patient
				}
			}
			modifier = {
				add = 7 
				has_trait = greedy
				NOR = {
					has_trait = just
					has_trait = temperate
					has_trait = compassionate
					has_trait = patient
				}
			}
		}
	}
	option = { #I don't need your help
		name = ck_geroian_events.0007.b
		
		add_prestige = 100
		stress_impact = {
			arrogant = medium_stress_loss
		}
		
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 10 
				has_trait = arrogant
			}
		}
	}
}
ck_geroian_events.0008 = { ### Landowners sponsor a host
	type = character_event
	title = ck_geroian_events.0008.t
	desc = ck_geroian_events.0008.desc
	theme = war
	right_portrait = {
		character = root
		animation = personality_bold
	}
	override_background = { reference = farmland }
	
	immediate = {
		every_character_war = {
			limit = {
				has_variable = geroian_assistance_yet_to_decide_var
			}
			save_scope_as = geroian_war
		}
		random_held_title = {
			limit = {
				tier = tier_county
				title_province = {
					geographical_region = region_geroia
				}
			}
			save_scope_as = landowners_county
		}
	}
	option = { # Accept their help
		name = ck_geroian_events.0008.a
		
		custom_tooltip = {
			text = geroian_landowner_host_tt
			spawn_army = {
				war = scope:geroian_war
				men_at_arms = {
					type = geroian_light_cavalry
					men = 300
				}
				men_at_arms = {
					type = geroian_horse_archers
					men = 200
				}
				location = root.capital_province
				inheritable = no
				name = geroian_landowner_host_army
			}
		}
		scope:landowners_county = {
			add_county_modifier = {
				modifier = landowners_privileges_modifier
				years = 3
			}
		}
		stress_impact = {
			arrogant = medium_stress_impact_gain
		}
		
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 10
			modifier = {
				add = -10 
				has_trait = arrogant
			}
		}
	}
	option = { #You will help me whether you like it or not
		name = ck_geroian_events.0008.c
		
		add_tyranny = 10
		custom_tooltip = {
			text = geroian_landowner_host_tt
			spawn_army = {
				war = scope:geroian_war
				men_at_arms = {
					type = geroian_light_cavalry
					men = 300
				}
				men_at_arms = {
					type = geroian_horse_archers
					men = 200
				}
				location = root.capital_province
				inheritable = no
				name = geroian_landowner_host_army
			}
		}
		add_prestige = major_prestige_loss
		add_dread = 15
		add_character_modifier = {
			modifier = extorted_minor_nobility_modifier
			years = 5
		}
		
		stress_impact = {
			wrathful = medium_stress_loss
			greedy = minor_stress_loss
		}
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 20 
				has_trait = wrathful
				NOR = {
					has_trait = just
					has_trait = temperate
					has_trait = compassionate
					has_trait = patient
				}
			}
			modifier = {
				add = 7 
				has_trait = greedy
				NOR = {
					has_trait = just
					has_trait = temperate
					has_trait = compassionate
					has_trait = patient
				}
			}
		}
	}
	option = { #I don't need your help
		name = ck_geroian_events.0008.b
		
		add_prestige = 100
		stress_impact = {
			arrogant = medium_stress_loss
		}
		
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 10 
				has_trait = arrogant
			}
		}
	}
}
ck_geroian_events.0009 = { ### Warrior monk arrives with his host
	type = character_event
	title = ck_geroian_events.0009.t
	desc = ck_geroian_events.0009.desc
	theme = war
	left_portrait = {
		character = scope:geroian_monk
		animation = marshal_mace
	}
	right_portrait = {
		character = root
		animation = personality_bold
	}
	override_background = { reference = wilderness_mountains }
	
	immediate = {
		every_character_war = {
			limit = {
				has_variable = geroian_assistance_yet_to_decide_var
			}
			save_scope_as = geroian_war
		}
		create_character = {
			age = { 40 60 }
			gender = male
			trait = brave
			trait = organizer
			trait = zealous
			trait = order_member
			random_traits_list = {
				education_martial_3 = { }
				education_martial_4 = { }
			}
			faith = root.faith
			culture = root.culture
			location = root.capital_province
			dynasty = none
			prowess = { 11 17 }
			martial = { 9 12 }
			save_scope_as = geroian_monk
		}
	}
	option = { # Accept his help
		name = ck_geroian_events.0009.a
		
		custom_tooltip = {
			text = geroian_monk_host_tt
			spawn_army = {
				war = scope:geroian_war
				men_at_arms = {
					type = geroian_pikemen_2
					men = 500
				}
				men_at_arms = {
					type = geroian_light_infantry
					men = 500
				}
				location = root.capital_province
				inheritable = no
				name = geroian_monk_host_army
			}
		}
		add_courtier = scope:geroian_monk
		scope:geroian_monk = {
			add_character_flag = geroian_warrior_monk
		}
		stress_impact = {
			arrogant = medium_stress_impact_gain
		}
		
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 10
			modifier = {
				add = -10 
				has_trait = arrogant
			}
		}
	}
	option = { #I don't need your help
		name = ck_geroian_events.0009.b
		
		add_prestige = 100
		add_piety = -100
		scope:geroian_commoner = {
			silent_disappearance_effect = yes
		}
		stress_impact = {
			arrogant = medium_stress_loss
		}
		
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 10 
				has_trait = arrogant
			}
		}
	}
}
ck_geroian_events.0010 = { ### Burghers give monetary assitance
	type = character_event
	title = ck_geroian_events.0010.t
	desc = ck_geroian_events.0010.desc
	theme = war
	right_portrait = {
		character = root
		animation = interested
	}
	override_background = { reference = council_chamber }
	
	immediate = {
		every_character_war = {
			limit = {
				has_variable = geroian_assistance_yet_to_decide_var
			}
			save_scope_as = geroian_war
		}
	}
	option = { # Accept their help
		name = ck_geroian_events.0010.a
		
		add_gold = 200
		add_character_modifier = {
			modifier = burghers_aid_modifier
			months = 9
		}
		
		stress_impact = {
			arrogant = medium_stress_impact_gain
		}
		
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 10
			modifier = {
				add = -10 
				has_trait = arrogant
			}
		}
	}
	option = { #I don't need your help
		name = ck_geroian_events.0010.b
		
		add_prestige = 100
		stress_impact = {
			arrogant = medium_stress_loss
		}
		
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 10 
				has_trait = arrogant
			}
		}
	}
}
ck_geroian_events.0011 = { ### Commoners rally up
	type = character_event
	title = ck_geroian_events.0011.t
	desc = ck_geroian_events.0011.desc
	theme = war
	right_portrait = {
		character = root
		animation = war_over_win
	}
	override_background = { reference = farmland }
	
	immediate = {
		every_character_war = {
			limit = {
				has_variable = geroian_assistance_yet_to_decide_var
			}
			save_scope_as = geroian_war
		}
	}
	option = { # Accept their help
		name = ck_geroian_events.0011.a
		
		add_character_modifier = {
			modifier = commoners_rally_up_modifier
			months = 9
		}
		
		stress_impact = {
			arrogant = medium_stress_impact_gain
		}
		
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 10
			modifier = {
				add = -10 
				has_trait = arrogant
			}
		}
	}
	option = { #I don't need your help
		name = ck_geroian_events.0011.b
		
		add_prestige = 100
		stress_impact = {
			arrogant = medium_stress_loss
		}
		
		scope:geroian_war = {
			remove_variable = geroian_assistance_yet_to_decide_var
			set_variable = geroian_assistance_decided_var
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 10 
				has_trait = arrogant
			}
		}
	}
}
## Thonian Unification
ck_geroian_events.0012 = { ### Unification of Thonians - unifier pov
	type = character_event
	title = ck_geroian_events.0012.t
	desc = ck_geroian_events.0012.desc
	theme = realm
	right_portrait = {
		character = root
		animation = personality_bold
	}
	override_background = { reference = wilderness_mountains }
	
	option = {
		name = ck_geroian_events.0012.a
		
		add_prestige = 400
		add_legitimacy = 50
		give_nickname = nick_the_unifier_ck
		
		save_scope_as = thonian_king
		every_player = {
			limit = {
				NOT = {
					this = root
				}
				OR = {
					capital_province ?= {
						geographical_region = region_wineyards
					}
					location = {
						geographical_region = region_wineyards
					}
				}
			}
			trigger_event = ck_geroian_events.0013
		}
	}
}
ck_geroian_events.0013 = { ### Unification of Thonians - outsider pov
	type = character_event
	title = ck_geroian_events.0013.t
	desc = ck_geroian_events.0013.desc
	theme = realm
	right_portrait = {
		character = scope:thonian_king
		animation = personality_bold
	}
	override_background = { reference = wilderness_mountains }
	
	option = {
		name = ck_geroian_events.0013.a
		
	}
}

### Flavor Events ###
# "The Melancholic Ransom Broker" - Broker w/ a bounty on his head
ck_geroian_events.0016 = {
	type = character_event
	title = ck_geroian_events.0016.t
	desc = ck_geroian_events.0016.desc
	theme = realm

	left_portrait = {
		character = scope:root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:geroian_1000_zarminner
		animation = beg
	}
	lower_center_portrait = {
		character = scope:ck_notable_geroia_target
		animation = anger
	}

	override_background = { reference = council_chamber }
	trigger = {
		root.capital_province = {
			geographical_region = region_geroia
		}
		culture = {
			has_cultural_pillar = heritage_geroian
		}
		NOT = { has_global_variable = spawned_zarminner }
	}
	immediate = {
		create_character = {
			template = geroian_events_1000_template
			name = "Zarminner"
			location = root.capital_province
			save_scope_as = geroian_1000_zarminner
			after_creation = {
				add_prestige = 200
				add_gold = 150
			}
		}
		random_ruler = {
			limit = {
				capital_province = {
					geographical_region = region_perassic
				}
				is_ai = yes
				highest_held_title_tier <= tier_duchy
				is_capable_adult = yes
				short_term_gold >= major_gold_value
			}
			add_opinion = {
				target = scope:geroian_1000_zarminner
				modifier = geroian_ransomed_my_family_member
			}
			save_scope_as = ck_notable_geroia_target
		}
		set_global_variable = {
			name = spawned_zarminner
			value = yes
		}
	}

	option = {
		name = ck_geroian_events.0016.a
		add_character_modifier = {
			modifier = assisted_ransom_broker
			years = 5
		}
		pay_short_term_gold = {
			target = scope:ck_notable_geroia_target
			gold = calking_geroian_diplo_cost_check
		}
		scope:geroian_1000_zarminner = {
			if = {
				limit = {
					short_term_gold >= 100
				}
				pay_short_term_gold = {
					target = root
					gold = { 25 50 }
				}
			}
			add_opinion = {
				target = root
				modifier = grateful_opinion
				opinion = 50
			}
		}
		custom_tooltip = ck_geroian_events.0016.a_tooltip
	}
	option = {
		name = ck_geroian_events.0016.b
		add_character_modifier = {
			modifier = captured_ransom_broker
			years = 10
		}
		scope:ck_notable_geroia_target = {
			pay_short_term_gold = {
				target = root
				gold = { 100 200 }
			}
			add_opinion = {
				target = root
				modifier = grateful_opinion
				opinion = 40
			}
		}
		scope:geroian_1000_zarminner = {
			add_opinion = {
				target = root
				modifier = respect_opinion
				opinion = -100
			}
		}
		hard_imprison_character_effect = {
			TARGET = scope:geroian_1000_zarminner
			IMPRISONER = scope:ck_notable_geroia_target
		}
		custom_tooltip = ck_geroian_events.0016.b_tooltip
	}

}
# ck_geroian_events.0017 = { # Merchant of Men (Commented out while WIP

# }
ck_geroian_events.0018 = { # Piracy Infestation - Caused from unresolved pirate in coastal county after 1.5 years
	type = character_event
	title = ck_geroian_events.0018.t
	desc = ck_geroian_events.0018.desc
	theme = realm

	left_portrait = {
		character = root
		animation = war_over_loss
	}
	right_portrait = {
		character = cp:councillor_marshal
		animation = shame
	}

	override_background = { reference = fp1_beached_longships }
	trigger = {
		root.capital_province = {
			geographical_region = region_geroia
		}
		exists = cp:councillor_marshal
		scope:councillor = cp:councillor_marshal
		NOT = {
			has_character_flag = had_geroian_event_0018_recently
		}
		random_sub_realm_county ?= {
			limit = {
				AND = {
					has_county_modifier = geroian_0018_pirate_activity
					any_county_province = {
						is_coastal = yes
					}
				}
			}
		}
	}
	immediate = {
		cp:councillor_marshal = {
			save_scope_as = marshal
		}
		random_sub_realm_county ?= {
			limit = {
				AND = {
					has_county_modifier = geroian_0018_pirate_activity
					any_county_province = {
						is_coastal = yes
					}
				}
			}
			save_scope_as = pirate_county_geroia
		}
		random_neighboring_county = {
			limit = {
				any_county_province = {
					AND = {
						is_coastal = yes
						geographical_region = region_geroia
					}
				}
				holder = {
					NAND = { 
						top_liege = root.top_liege
						this = root 
					}
				}
			}
			save_scope_as = neighboring_county_geroian
		}
	}

	option = {
		name = ck_geroian_events.0018.a
		custom_tooltip = had_geroian_event_0018_tt
		duel = {
			skill = martial
			value = high_skill_rating
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				custom_tooltip = {
					text = freed_of_pirates_tt
					add_character_flag = {
						flag = had_geroian_event_0018_recently
						years = 30
					}
				}
				custom_tooltip = {
					text = earned_pirate_loot
					add_gold = 70
				}
				scope:pirate_county_geroia = {
					change_county_control = 30
					remove_county_modifier = geroian_0018_pirate_activity
				}
			}
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				custom_tooltip = {
					text = rampaging_pirates_tt
					add_character_flag = {
						flag = had_geroian_event_0018_recently
						years = 30
					}
					trigger_event = {
						id = ck_geroian_events.1002
						days = 60
					}
				}
				scope:pirate_county_geroia = {
					change_county_control = -15
					change_development_level = {
						value = scope:pirate_county_geroia.development_level
						multiply = -0.2
						round = yes
					}
				}
			}
		}

	}

	option = {
		name = ck_geroian_events.0018.b
		custom_tooltip = had_geroian_event_0018_tt.2
		add_prestige = -50
		duel = {
			skill = stewardship
			value = 15
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				remove_short_term_gold = 25
				add_character_modifier = {
					modifier = encouraged_piracy_modifier
				}
				scope:neighboring_county_geroian = {
					add_county_modifier = {
						modifier = geroian_0018_pirate_activity
					}
					holder = {
						add_opinion = {
							target = root
							modifier = geroian_encouraged_piracy
						}
					}
					if = {
						limit = {
							exists = holder.top_liege
						}
						holder.top_liege = {
							add_opinion = {
								target = root
								modifier = geroian_encouraged_piracy
							}
						}
					}
				}
			}
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				custom_tooltip = {
					text = rampaging_pirates_tt
					add_character_flag = {
						flag = had_geroian_event_0018_recently
						years = 30
					}
					trigger_event = {
						id = ck_geroian_events.1002
						days = 60
					}
				}
				scope:pirate_county_geroia = {
					change_county_control = -15
					change_development_level = {
						value = scope:pirate_county_geroia.development_level
						multiply = -0.2
						round = yes
					}
				}
				remove_short_term_gold = 50
			}
		}
	}
}

# Misc/Background Events #
ck_geroian_events.1001 = { # Collect Taxes Side Effect - Is the Task That Creates the Pirates 
	hidden = yes

	trigger = {
		exists = cp:councillor_steward
		scope:councillor = cp:councillor_steward
		scope:councillor = {
			stewardship < high_skill_rating
		}
		any_sub_realm_county = {
			steward_task_county_corruption_county_trigger = yes
		}
		NOR = {
			has_character_flag = geroian_event_0018_cooldown
			has_character_flag = had_geroian_event_0018_recently
		}
	}

	weight_multiplier = {
		base = 1
		compare_modifier = {
			target = scope:councillor
			value = stewardship
			multiplier = -0.2
			offset = inverted_high_skill_rating
		}
	}

	immediate = {
		cp:councillor_steward = {
			save_scope_as = active_councillor
		}
		set_variable = {
			name = had_steward_task_side_effect
			value = yes
			days = steward_task_side_effect_cooldown
		}
		random_sub_realm_county = {
			limit = {
				steward_task_county_corruption_county_trigger = yes
				any_county_province = {
					is_coastal = yes
				}
			}
			weight = {
				base = 1
				modifier = {
					add = 5
					holder = root
				}
			}
			save_scope_as = county
		}

		send_interface_message = {
			type = msg_steward_task_bad
			title = steward_task.1001.notification
			desc = {
				triggered_desc = {
					trigger = {
						scope:active_councillor = { stewardship <= average_skill_level }
					}
					desc = task_stewardship_bad_unskilled_notification_tooltip
				}
				triggered_desc = {
					trigger = {
						scope:active_councillor = { stewardship > average_skill_level }
					}
					desc = task_stewardship_bad_skilled_notification_tooltip
				}
			}
			
			left_icon = scope:county
			right_icon = scope:councillor
			tooltip = task_collect_taxes_notification_tooltip

			scope:county = {
				add_county_modifier = {
					modifier = geroian_0018_pirate_activity
					days = steward_task_modifier_duration
				}
				holder = {
					trigger_event = {
						id = ck_geroian_events.0018
						months = { 17 24 }
					}
				}
			}
		}
	}
}
ck_geroian_events.1002 = { # Modifier cleanup
	hidden = yes

	trigger = {
		scope:pirate_county_geroia = {
			has_county_modifier = geroian_0018_pirate_activity
		}
	}

	immediate = {
		scope:pirate_county_geroia = {
			remove_county_modifier = geroian_0018_pirate_activity
		}
	}
}